# 色彩空间转换的可重构硬件实现
作者：F.Bensaali*,A.Amira  
英国贝尔法斯特女王大学，计算机科学院。  
接受于2004.06.27；修订版本在2005.03.25收到；在2005.03.30被接收。  

## 概要

色彩空间转换对于包括包括视频压缩在内的许多种图像处理应用而言都是十分重要的。这一操作在高度优化的解码器中的功耗比例接近于40%。这也就是说，一种能够有效实行这种转换的方法是为我们所期望的。这篇论文针对色彩空间转换的有效实行提出了两个新的结构，它们都适用于现场和编程逻辑阵列（FPGA）和VLSI的实现。这些结构都是基于分布式算法（DA）ROM累加器原理，并且已经被完成，还在Celoxica RC1000 FPGA 开发板上完成了验证。此外，它们是平台无关的，同时拥有着低延迟（八个周期）。第一个结构拥有高度的吞吐量，第二个则是完全流水化的，同时拥有一个能够将数据速率持续保持在234百万转换每秒的吞吐量。  
2005 Elsevier有限公司拥有所有权利.  
关键词：色彩空间转换；现场可编程逻辑阵列；分布式算法  

## 1. 前言

色彩是视网膜上的可见区域对于光所引起的频谱变化的一种视觉感受。由于人类的视觉系统拥有三种类型的视锥细胞，所以对于描述色彩而言，三个不同的成分是充分并且必要的。  
色彩空间（也被称为色彩模式或者色彩系统）是一种我们可以用于定义、创造和构想颜色的方法。现在已经有许多色彩空间存在，并且其中的绝大多数都是以每一种颜色作为一个三维坐标系统的一个点。每种色彩空间都是为了已经定义好的应用领域而优化的。其中三个最流行的色彩模式是RGB（用于色彩打印领域）。所有的色彩空间都能够由被现实摄像头、扫描仪这样的硬件所支持的RGB信息派生出来。  
在RGB色彩空间内——一个由若干RGB值表示的像素点构成的集合内，对图像进行处理并不是最高效的。为了加速许多处理过程，许多广播、视频和图像使用亮度和色差信号标准，比如YCrCb，这使得在两种制式之间必须存在一个转换机制。一些可以实现RGB到YCrCb转换的核已经能够在市面上找到，就像是Amphion Ltd , CAST.Inc and ALMA.Tech 建议的那样，它们被设计为FPGA实现。另一种转换器也被提出，它已经被实现在由一个带有基于FPGA的可重构功能单元的TriMedia 处理器实现的混合系统中。  
作为在贝尔法斯特皇后大学正在进行的一个课题项目的一部分——针对于图像和信号处理算法，去开发一个基于矩阵运算的硬件加速器。本文提出了基于DA流水线，并且使用FPGA进行RGB和YCrCb色彩空间转换的、一个低成本的加速器，DA流水线是去隐藏乘法的一个乘法运算的比特级重排。这两个被提出的结构都基于一些像素的串行和并行操作。  
实现和验证被提出的结构的目标硬件是配有Xilinx公司XCV2000E Virtex FPGA的Celoxica
RC1000 PCI开发板。本文其他部分的组成如下：第二节给出了从RGB到YCrCb的一个综述，第三节和第四节则是两种结构所涉及的数学背景和描述。硬件实现的结果和分析则是被列于第五和第六节。最终的结束语在第六节被给出。  

## 2. 色彩空间转换：一个综述

在概要中许多色彩模式都被提到了，每一种都倾向于支持一种特定的任务或者解决某个针对性的问题。下面被描述的是两种被选择于我们研究的对象，它们被用于许多图像处理应用中。  

### 2.1. RGB色彩空间

RGB色彩空间是一种简单和健壮的色彩定义形式。RGB使用三个数字部分去描述一种色彩。这种色彩空间能够被认为是一种三维空间坐标系统，坐标系的每个轴对应色彩的每一种成分，R或者红色，G或者绿色，B或者蓝色。RGB是一种适用于电脑显示的色彩空间，它的对应非常接近于人类眼睛的行为。RGB也是一种加色系统，三种基本的色彩“红”、“绿”、“蓝”被叠加在一起去组成期望的色彩。对于真彩色，每个像素的红绿蓝三个部分都需要八位的位宽。总体来看，大概需要16百万（2^24）可能的颜色，而每个部分的范围都在0-255之间，当每个部分都是0的时候为黑，都为255的时候为白。在本文其他的部分，被伽马校正过的RBG值被标记为R'G'B'。  

### 2.2. Y'CrCb色彩空间

T'CrCb色彩空间是TUV色彩空间的一种偏移和缩放，它基于亮度和色度，这对应于明度和色彩。在R'G'B'色彩空间内就是分离到亮度部分（Y'）和两个色度部分（Cr和Cb）。Y'被定义在范围16-235内，Cb和Cr的范围则是16-240。  

### 2.3. 从R'G'B'转换到Y'CrCb

分解一个R'G'B'色彩空间的图像到亮度图像以及两个色度图像是许多商业应用中最常用的方法，比如人脸检测，以及JPEG和MPEG图像标准。  
估算来讲，从R'G'B'合成转换到Y'CrCb合成的功耗占据了高度优化解码器的40%。加速这个操作对于整个运算的加速将会十分有用。将一个R'G'B'色彩空间的颜色转换到Y'CrCb色彩空间会用到以下等式：  
![](1.png)  
随后其反变换可以从以下等式得出：  
![](2.png)  

## 3. 基于串行处理方法的结构

### 3.1 数学背景

自从色彩空间转换可以被表述为一个矩阵向量（MV）操作，一种基于DA的新算法在本节中本提出。  
DA，分布式算术运算而不是将它们分组相乘。常规的DA被称为基于ROM的DA，通过分解内积的可见输入变量到比特级，去生成预处理的数据。基于ROM的DA使用一个查找表去存储预处理数据，这种方法能够在一个VLSI实现中使得芯片面积被完全和有效的使用。基于DA的ROM方法的优势在于它的实现效率。基本的需求是一个ROM序列、加法、减法和对于输入数据序列的移位操作。一个DA用法的例子可以在这些参考文献中被找到[19-21]。  
考虑以下等式的矩阵向量积：  
![](3.png)  
公式中的{Aik}'s是一个Lbits的常量，{Bk}'s则是被写在一个无符号二进制数表达式，如式中所见。  
![](4.png)  
式中bk,l表示Bk的第m位，0或者1，W表示每个像素的颜色分量解析度的位宽。  
将（4）带入（3）：  
![](5.png)  
定义：  
![](6.png)  
从而Ci可以用一下公式计算：  
![](7.png)  
这种想法的可行性来自于到元素Zm依赖于k.m并且仅仅有2^N个可能的值，这保证了一个ROM是有可能对它们进行预处理和存储操作的。ROM的内容不同且依赖于一个静态的系数矩阵A。这些中间结果在W个时钟周期被积累，并且生成Ci系数矩阵。  

### 3.2 个案研究：在R'G'B和Y'CrCb之间转换
